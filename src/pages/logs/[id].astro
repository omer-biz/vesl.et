---
import { render } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { Image } from 'astro:assets';
import getLogsCollection from "../../lib/logsCollection.ts";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";

export async function getStaticPaths() {
    const logs = await getLogsCollection();
    const sortedLogs = logs.sort((a, b)=> b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

    return sortedLogs.map((log, index) => ({
        params: { id: log.id },
        props: {
            log,
            prevLog: sortedLogs[index + 1] || null,
            nextLog: sortedLogs[index - 1] || null,
        },
    }))
}

const { log, prevLog, nextLog } = Astro.props;
const { Content, remarkPluginFrontmatter } = await render(log);

const pubDate = log.data.pubDate.toDateString();
---
<BaseLayout title={log.data.title}>
<Header />
<main class="max-w-6xl mx-auto py-12 md:px-6 font-mono text-stone-800 bg-stone-200">
  <div class="flex flex-col lg:flex-row gap-12">
    <article class="flex-grow max-w-3xl">
      <header class="mb-8">
        <h1 class="text-3xl md:text-4xl font-bold text-stone-900 leading-tight mb-4">
          {log.data.title}
        </h1>

        <div class="flex items-center gap-4 text-xs text-stone-500 uppercase tracking-widest mb-4">
          <span class="bg-amber-700/10 text-amber-800 px-2 py-0.5 rounded-sm">{pubDate}</span>
          <span>â€¢</span>
          <span>{remarkPluginFrontmatter.minutesRead}</span>
          {log.data.draft && (
            <span class="border border-red-800/50 text-red-800 px-2 py-0.5 rounded-sm">Draft</span>
          )}
        </div>
        
        <p class="text-xl text-stone-600 leading-relaxed italic">
          {log.data.description}
        </p>
      </header>

      {log.data.heroImage && (
      <figure class="mb-12 border-2 border-stone-400/30 p-2 bg-stone-100 shadow-sm">
          <Image src={log.data.heroImage} alt="Abstract tech background" class="w-full h-auto grayscale hover:grayscale-0 transition-all duration-700" />
          <!-- <figcaption class="mt-2 text-[10px] text-stone-400 uppercase text-center">
               </figcaption> -->
      </figure> 
      )}

      <div class="prose prose-stone max-w-none 
                  prose-headings:text-stone-900 prose-headings:font-bold 
                  prose-p:leading-relaxed prose-p:text-stone-700
                  prose-code:px-1 prose-code:rounded
                  prose-pre:bg-stone-800 prose-pre:text-stone-100">
          <Content />
      </div>

      <footer class="mt-24 pt-8 border-t-2 border-dashed border-stone-400/30">
        <div class="flex justify-between items-center">

          {prevLog && (
          <div class="flex flex-col items-start gap-1">
            <span class="text-[10px] text-stone-400 uppercase tracking-tighter">Previous Log</span>
            <a href={`/logs/${prevLog.id}`} class="text-sm font-bold text-orange-800 hover:text-teal-700 transition-colors max-w-[150px] md:max-w-xs truncate">
              [&lt; {prevLog.data.title}]
            </a>
          </div>)}

          {nextLog && (
          <div class="flex flex-col items-end gap-1">
            <span class="text-[10px] text-stone-400 uppercase tracking-tighter text-right">Next Log</span>
            <a href={`/logs/${nextLog.id}`} class="text-sm font-bold text-orange-800 hover:text-teal-700 transition-colors max-w-[150px] md:max-w-xs truncate">
              [{nextLog.data.title} -&gt;]
            </a>
          </div>)}

        </div>
      </footer>
    </article>

  </div>
</main>
<Footer />
</BaseLayout>
